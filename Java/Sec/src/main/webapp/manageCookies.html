<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Cookie UI</title>
    <style>
        body { font-family: sans-serif; padding: 20px; font-size: 13px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
        th { background: #f0f0f0; }
        input, select { width: 90%; }
        .new-row { background: #fafff0; font-weight: bold; }
        button { padding: 10px; cursor: pointer; margin-right: 10px; }
    </style>
</head>
<body>

    <h2>Cookie Property Manager</h2>
    <button onclick="fetchCookies()">Refresh</button>
    <button style="background: #4CAF50; color: white;" onclick="saveAll()">Sync All (Update/New)</button>

    <table id="cookieTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Value</th>
                <th>Path</th>
                <th>Domain</th>
                <th>Max-Age</th>
                <th>SameSite</th>
                <th>HttpOnly</th>
                <th>Secure</th>
            </tr>
        </thead>
        <tbody id="cookieBody"></tbody>
        <tfoot class="new-row">
            <tr>
                <td><input type="text" id="newName" placeholder="NEW_NAME"></td>
                <td><input type="text" id="newValue" placeholder="value"></td>
                <td><input type="text" id="newPath" value="/"></td>
                <td><input type="text" id="newDomain" placeholder="example.com"></td>
                <td><input type="number" id="newMaxAge" value="3600"></td>
                <td>
                    <select id="newSameSite">
                        <option value="Lax">Lax</option>
                        <option value="None">None</option>
                        <option value="Strict">Strict</option>
                    </select>
                </td>
                <td><input type="checkbox" id="newHttpOnly"></td>
                <td><input type="checkbox" id="newSecure"></td>
            </tr>
        </tfoot>
    </table>

    <script>
        const ENDPOINT = 'managecookie';

        async function fetchCookies() {
            const r = await fetch(ENDPOINT);
            const data = await r.json();
            const body = document.getElementById('cookieBody');
            body.innerHTML = '';
            
            data.cookies.forEach(c => {
                body.innerHTML += `<tr class="c-row">
                    <td><input type="text" class="name" value="${c.name}" readonly></td>
                    <td><input type="text" class="value" value="${c.value}"></td>
                    <td><input type="text" class="path" value="${c.path || '/'}"></td>
                    <td><input type="text" class="domain" value="${c.domain || ''}"></td>
                    <td><input type="number" class="maxAge" value="${c.maxAge>0?c.maxAge:3600}"></td>
                    <td>
                        <select class="sameSite">
                        <option value="Lax">Lax</option>
                    		<option value="None">None</option>
                            <option value="Strict">Strict</option>
                        </select>
                    </td>
                    <td><input type="checkbox" class="httpOnly" ${c.httpOnly ? 'checked' : ''}></td>
                    <td><input type="checkbox" class="secure" ${c.secure ? 'checked' : ''}></td>
                </tr>`;
            });
        }

        async function saveAll() {
            const cookies = [];
            
            // Collect existing
            document.querySelectorAll('.c-row').forEach(row => {
                cookies.push(extract(row));
            });

            // Collect new row
            const newName = document.getElementById('newName').value;
            if(newName) {
                cookies.push({
                    name: newName,
                    value: document.getElementById('newValue').value,
                    path: document.getElementById('newPath').value,
                    domain: document.getElementById('newDomain').value,
                    maxAge: parseInt(document.getElementById('newMaxAge').value),
                    sameSite: document.getElementById('newSameSite').value,
                    httpOnly: document.getElementById('newHttpOnly').checked,
                    secure: document.getElementById('newSecure').checked
                });
            }

            await fetch(ENDPOINT, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(cookies)
            });
            alert('Updated!');
            document.getElementById('newValue').value="";
            document.getElementById('newName').value="";
            document.getElementById('newDomain').value="";
            fetchCookies();
        }

        function extract(row) {
            let ma = parseInt(row.querySelector('.maxAge').value);
            return {
                name: row.querySelector('.name').value,
                value: row.querySelector('.value').value,
                path: row.querySelector('.path').value || "/",
                domain: row.querySelector('.domain').value.trim(), 
                maxAge: (!Number.isNaN(ma)) ? ma : 3600,
                sameSite: row.querySelector('.sameSite').value,
                httpOnly: row.querySelector('.httpOnly').checked,
                secure: row.querySelector('.secure').checked
            };
        }

        window.onload = fetchCookies;
    </script>
</body>
</html>